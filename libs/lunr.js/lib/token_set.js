/*!
 * lunr.TokenSet
 * Copyright (C) @YEAR Oliver Nightingale
 */
lunr.TokenSet=function(){this.final=!1,this.edges={},this.id=lunr.TokenSet._nextId,lunr.TokenSet._nextId+=1},lunr.TokenSet._nextId=1,lunr.TokenSet.fromArray=function(e){for(var n=new lunr.TokenSet.Builder,t=0,r=e.length;t<r;t++)n.insert(e[t]);return n.finish(),n.root},lunr.TokenSet.fromClause=function(e){return"editDistance"in e?lunr.TokenSet.fromFuzzyString(e.term,e.editDistance):lunr.TokenSet.fromString(e.term)},lunr.TokenSet.fromFuzzyString=function(e,n){for(var t=new lunr.TokenSet,r=[{node:t,editsRemaining:n,str:e}];r.length;){var i=r.pop();if(i.str.length>0){var o,s=i.str.charAt(0);s in i.node.edges?o=i.node.edges[s]:(o=new lunr.TokenSet,i.node.edges[s]=o),1==i.str.length&&(o.final=!0),r.push({node:o,editsRemaining:i.editsRemaining,str:i.str.slice(1)})}if(0!=i.editsRemaining){if("*"in i.node.edges)var d=i.node.edges["*"];else{d=new lunr.TokenSet;i.node.edges["*"]=d}if(0==i.str.length&&(d.final=!0),r.push({node:d,editsRemaining:i.editsRemaining-1,str:i.str}),i.str.length>1&&r.push({node:i.node,editsRemaining:i.editsRemaining-1,str:i.str.slice(1)}),1==i.str.length&&(i.node.final=!0),i.str.length>=1){if("*"in i.node.edges)var l=i.node.edges["*"];else{l=new lunr.TokenSet;i.node.edges["*"]=l}1==i.str.length&&(l.final=!0),r.push({node:l,editsRemaining:i.editsRemaining-1,str:i.str.slice(1)})}if(i.str.length>1){var u,g=i.str.charAt(0),a=i.str.charAt(1);a in i.node.edges?u=i.node.edges[a]:(u=new lunr.TokenSet,i.node.edges[a]=u),1==i.str.length&&(u.final=!0),r.push({node:u,editsRemaining:i.editsRemaining-1,str:g+i.str.slice(2)})}}}return t},lunr.TokenSet.fromString=function(e){for(var n=new lunr.TokenSet,t=n,r=0,i=e.length;r<i;r++){var o=e[r],s=r==i-1;if("*"==o)n.edges[o]=n,n.final=s;else{var d=new lunr.TokenSet;d.final=s,n.edges[o]=d,n=d}}return t},lunr.TokenSet.prototype.toArray=function(){for(var e=[],n=[{prefix:"",node:this}];n.length;){var t=n.pop(),r=Object.keys(t.node.edges),i=r.length;t.node.final&&(t.prefix.charAt(0),e.push(t.prefix));for(var o=0;o<i;o++){var s=r[o];n.push({prefix:t.prefix.concat(s),node:t.node.edges[s]})}}return e},lunr.TokenSet.prototype.toString=function(){if(this._str)return this._str;for(var e=this.final?"1":"0",n=Object.keys(this.edges).sort(),t=n.length,r=0;r<t;r++){var i=n[r];e=e+i+this.edges[i].id}return e},lunr.TokenSet.prototype.intersect=function(e){for(var n=new lunr.TokenSet,t=undefined,r=[{qNode:e,output:n,node:this}];r.length;){t=r.pop();for(var i=Object.keys(t.qNode.edges),o=i.length,s=Object.keys(t.node.edges),d=s.length,l=0;l<o;l++)for(var u=i[l],g=0;g<d;g++){var a=s[g];if(a==u||"*"==u){var f=t.node.edges[a],h=t.qNode.edges[u],p=f.final&&h.final,S=undefined;a in t.output.edges?(S=t.output.edges[a]).final=S.final||p:((S=new lunr.TokenSet).final=p,t.output.edges[a]=S),r.push({qNode:h,output:S,node:f})}}}return n};