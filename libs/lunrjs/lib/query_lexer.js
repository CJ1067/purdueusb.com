lunr.QueryLexer=function(e){this.lexemes=[],this.str=e,this.length=e.length,this.pos=0,this.start=0,this.escapeCharPositions=[]},lunr.QueryLexer.prototype.run=function(){for(var e=lunr.QueryLexer.lexText;e;)e=e(this)},lunr.QueryLexer.prototype.sliceString=function(){for(var e=[],r=this.start,t=this.pos,u=0;u<this.escapeCharPositions.length;u++)t=this.escapeCharPositions[u],e.push(this.str.slice(r,t)),r=t+1;return e.push(this.str.slice(r,this.pos)),this.escapeCharPositions.length=0,e.join("")},lunr.QueryLexer.prototype.emit=function(e){this.lexemes.push({type:e,str:this.sliceString(),start:this.start,end:this.pos}),this.start=this.pos},lunr.QueryLexer.prototype.escapeCharacter=function(){this.escapeCharPositions.push(this.pos-1),this.pos+=1},lunr.QueryLexer.prototype.next=function(){if(this.pos>=this.length)return lunr.QueryLexer.EOS;var e=this.str.charAt(this.pos);return this.pos+=1,e},lunr.QueryLexer.prototype.width=function(){return this.pos-this.start},lunr.QueryLexer.prototype.ignore=function(){this.start==this.pos&&(this.pos+=1),this.start=this.pos},lunr.QueryLexer.prototype.backup=function(){this.pos-=1},lunr.QueryLexer.prototype.acceptDigitRun=function(){var e,r;do{r=(e=this.next()).charCodeAt(0)}while(r>47&&r<58);e!=lunr.QueryLexer.EOS&&this.backup()},lunr.QueryLexer.prototype.more=function(){return this.pos<this.length},lunr.QueryLexer.EOS="EOS",lunr.QueryLexer.FIELD="FIELD",lunr.QueryLexer.TERM="TERM",lunr.QueryLexer.EDIT_DISTANCE="EDIT_DISTANCE",lunr.QueryLexer.BOOST="BOOST",lunr.QueryLexer.PRESENCE="PRESENCE",lunr.QueryLexer.lexField=function(e){return e.backup(),e.emit(lunr.QueryLexer.FIELD),e.ignore(),lunr.QueryLexer.lexText},lunr.QueryLexer.lexTerm=function(e){if(e.width()>1&&(e.backup(),e.emit(lunr.QueryLexer.TERM)),e.ignore(),e.more())return lunr.QueryLexer.lexText},lunr.QueryLexer.lexEditDistance=function(e){return e.ignore(),e.acceptDigitRun(),e.emit(lunr.QueryLexer.EDIT_DISTANCE),lunr.QueryLexer.lexText},lunr.QueryLexer.lexBoost=function(e){return e.ignore(),e.acceptDigitRun(),e.emit(lunr.QueryLexer.BOOST),lunr.QueryLexer.lexText},lunr.QueryLexer.lexEOS=function(e){e.width()>0&&e.emit(lunr.QueryLexer.TERM)},lunr.QueryLexer.termSeparator=lunr.tokenizer.separator,lunr.QueryLexer.lexText=function(e){for(;;){var r=e.next();if(r==lunr.QueryLexer.EOS)return lunr.QueryLexer.lexEOS;if(92!=r.charCodeAt(0)){if(":"==r)return lunr.QueryLexer.lexField;if("~"==r)return e.backup(),e.width()>0&&e.emit(lunr.QueryLexer.TERM),lunr.QueryLexer.lexEditDistance;if("^"==r)return e.backup(),e.width()>0&&e.emit(lunr.QueryLexer.TERM),lunr.QueryLexer.lexBoost;if("+"==r&&1===e.width())return e.emit(lunr.QueryLexer.PRESENCE),lunr.QueryLexer.lexText;if("-"==r&&1===e.width())return e.emit(lunr.QueryLexer.PRESENCE),lunr.QueryLexer.lexText;if(r.match(lunr.QueryLexer.termSeparator))return lunr.QueryLexer.lexTerm}else e.escapeCharacter()}};